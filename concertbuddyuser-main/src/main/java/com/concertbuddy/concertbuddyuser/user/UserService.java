package com.concertbuddy.concertbuddyuser.user;
import com.concertbuddy.concertbuddyuser.song.Song;
import com.concertbuddy.concertbuddyuser.song.SongRepository;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import org.springframework.aop.scope.ScopedProxyUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;
import org.springframework.http.*;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import java.util.UUID;
import java.util.HashMap;
import java.util.Map;

@Service
public class UserService {

    private final UserRepository userRepository;
    private final SongRepository songRepository;

    @Autowired
    public UserService(UserRepository userRepository, SongRepository songRepository) {
        this.userRepository = userRepository;
        this.songRepository = songRepository;
    }

    public List<User> getUsers() {
        return userRepository.findAll();
    }

    public List<User> getFilteredUsers(String nameFilter) {
        return userRepository.findByName(nameFilter);
    }

    public User getUserById(UUID userId) {
        Optional<User> optionalUserById = userRepository.findById(userId);
        if (optionalUserById.isEmpty()) {
            throw new IllegalStateException(
                    "User with id " + userId + " does not exist"
            );
        }
        return optionalUserById.get();
    }

    public UUID addNewUser(User user) {
        Optional<User> optionalUserByEmail = userRepository.findUserByEmail(user.getEmail());
        if (optionalUserByEmail.isPresent()) {
            return optionalUserByEmail.get().getId();
        }
        return userRepository.save(user).getId();
    }

    public void deleteUser(UUID userId) {
        boolean exists = userRepository.existsById(userId);
        if (!exists) {
            throw new IllegalStateException(
                    "User with id " + userId + " does not exist"
            );
        }
        userRepository.deleteById(userId);
    }

    public void addNewUserSong(UUID userId, UUID songId) {
        Optional<User> optionalUserById = userRepository.findById(userId);
        if (optionalUserById.isEmpty()) {
            throw new IllegalStateException(
                    "User with id " + userId + " does not exist"
            );
        }
        User userById = optionalUserById.get();
        Optional<Song> optionalSongById = songRepository.findById(songId);
        if (optionalSongById.isEmpty()) {
            throw new IllegalStateException(
                    "Song with id " + songId + " does not exist"
            );
        }
        Song songById = optionalSongById.get();
        // add songById to songs of userById
        List<Song> newUserByIdSongs = userById.getSongs();
        if (!(newUserByIdSongs.contains(songById))){
            newUserByIdSongs.add(songById);
        }
        userById.setSongs(newUserByIdSongs);
        // save the updated userById to database
        userRepository.save(userById);
    }

    public void deleteUserSong(UUID userId, UUID songId) {
        Optional<User> optionalUserById = userRepository.findById(userId);
        if (optionalUserById.isEmpty()) {
            throw new IllegalStateException(
                    "User with id " + userId + " does not exist"
            );
        }
        User userById = optionalUserById.get();
        Optional<Song> optionalSongById = songRepository.findById(songId);
        if (optionalSongById.isEmpty()) {
            throw new IllegalStateException(
                    "Song with id " + songId + " does not exist"
            );
        }
        Song songById = optionalSongById.get();
        // delete songById from songs of userById
        List<Song> newUserByIdSongs = userById.getSongs();
        newUserByIdSongs.remove(songById);
        userById.setSongs(newUserByIdSongs);
        // save the updated userById to database
        userRepository.save(userById);
    }

    public void SpotifySync(UUID userId, String SpotifyAccountToken) {
        // Spotify API call goes here
        Optional<User> optionalUserById = userRepository.findById(userId);
        if (optionalUserById.isEmpty()) {
            throw new IllegalStateException(
                    "User with id " + userId + " does not exist"
            );
        }
        User userById = optionalUserById.get();
        System.out.println(userById);
//        add call Get User's Playlist endpoint
        String UserPlayListsResponse = "{\"href\":\"https://api.spotify.com/v1/users/31j46t4742w2idmgceppiyrffhuy/playlists?offset=0&limit=20\",\"items\":[{\"collaborative\":false,\"description\":\"\",\"external_urls\":{\"spotify\":\"https://open.spotify.com/playlist/1nhGhw2dIcReJ3MJ51jZi9\"},\"href\":\"https://api.spotify.com/v1/playlists/1nhGhw2dIcReJ3MJ51jZi9\",\"id\":\"1nhGhw2dIcReJ3MJ51jZi9\",\"images\":[{\"height\":640,\"url\":\"https://mosaic.scdn.co/640/ab67616d0000b273442b53773d50e1b5369bb16cab67616d0000b27355404f712deb84d0650a4b41ab67616d0000b273647377a36072bd08e44dd32bab67616d0000b2736b55737cd9a2bba789b1d6ba\",\"width\":640},{\"height\":300,\"url\":\"https://mosaic.scdn.co/300/ab67616d0000b273442b53773d50e1b5369bb16cab67616d0000b27355404f712deb84d0650a4b41ab67616d0000b273647377a36072bd08e44dd32bab67616d0000b2736b55737cd9a2bba789b1d6ba\",\"width\":300},{\"height\":60,\"url\":\"https://mosaic.scdn.co/60/ab67616d0000b273442b53773d50e1b5369bb16cab67616d0000b27355404f712deb84d0650a4b41ab67616d0000b273647377a36072bd08e44dd32bab67616d0000b2736b55737cd9a2bba789b1d6ba\",\"width\":60}],\"name\":\"Test playlist 1\",\"owner\":{\"display_name\":\"Yutao Zhou\",\"external_urls\":{\"spotify\":\"https://open.spotify.com/user/31j46t4742w2idmgceppiyrffhuy\"},\"href\":\"https://api.spotify.com/v1/users/31j46t4742w2idmgceppiyrffhuy\",\"id\":\"31j46t4742w2idmgceppiyrffhuy\",\"type\":\"user\",\"uri\":\"spotify:user:31j46t4742w2idmgceppiyrffhuy\"},\"primary_color\":null,\"public\":true,\"snapshot_id\":\"OSwyZDE0MDMzY2EzYWJhM2JjOTJhODZlYjBhNzVlYjQxMjE5NDgxMTkz\",\"tracks\":{\"href\":\"https://api.spotify.com/v1/playlists/1nhGhw2dIcReJ3MJ51jZi9/tracks\",\"total\":7},\"type\":\"playlist\",\"uri\":\"spotify:playlist:1nhGhw2dIcReJ3MJ51jZi9\"}],\"limit\":20,\"next\":null,\"offset\":0,\"previous\":null,\"total\":1}";
        String currentUser = "31j46t4742w2idmgceppiyrffhuy";

        ObjectMapper objectMapper = new ObjectMapper();
        objectMapper.registerModule(new JavaTimeModule());
        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);

        try {
            UserPlayListResponse userPlayList = objectMapper.readValue(UserPlayListsResponse, UserPlayListResponse.class);
            List<PlaylistItem> playLists = userPlayList.getItems();
            if (!playLists.isEmpty()) {
                for (PlaylistItem playList : playLists) {
                    String owner = playList.getOwner().getId();
                    if (owner.equals(currentUser)) {
                        String track_url = playList.getTracks().getHref();
                        String playListResponse = "{\"href\":\"https://api.spotify.com/v1/playlists/1nhGhw2dIcReJ3MJ51jZi9/tracks?offset=0&limit=100&locale=en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7\",\"items\":[{\"added_at\":\"2023-11-19T19:34:38Z\",\"added_by\":{\"external_urls\":{\"spotify\":\"https://open.spotify.com/user/31j46t4742w2idmgceppiyrffhuy\"},\"href\":\"https://api.spotify.com/v1/users/31j46t4742w2idmgceppiyrffhuy\",\"id\":\"31j46t4742w2idmgceppiyrffhuy\",\"type\":\"user\",\"uri\":\"spotify:user:31j46t4742w2idmgceppiyrffhuy\"},\"is_local\":false,\"primary_color\":null,\"track\":{\"album\":{\"album_type\":\"compilation\",\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/0LyfQWJT6nXafLPZqxe9Of\"},\"href\":\"https://api.spotify.com/v1/artists/0LyfQWJT6nXafLPZqxe9Of\",\"id\":\"0LyfQWJT6nXafLPZqxe9Of\",\"name\":\"Various Artists\",\"type\":\"artist\",\"uri\":\"spotify:artist:0LyfQWJT6nXafLPZqxe9Of\"}],\"available_markets\":[\"AE\",\"AL\",\"AR\",\"AT\",\"AU\",\"BA\",\"BE\",\"BG\",\"BH\",\"BO\",\"BR\",\"CA\",\"CH\",\"CI\",\"CL\",\"CM\",\"CO\",\"CR\",\"CW\",\"CY\",\"CZ\",\"DE\",\"DK\",\"DO\",\"DZ\",\"EC\",\"EE\",\"EG\",\"ES\",\"FI\",\"FR\",\"GB\",\"GH\",\"GR\",\"GT\",\"HK\",\"HN\",\"HR\",\"HU\",\"ID\",\"IE\",\"IL\",\"IN\",\"IS\",\"IT\",\"JP\",\"KE\",\"KH\",\"KR\",\"KW\",\"LB\",\"LK\",\"LT\",\"LU\",\"LV\",\"MA\",\"ME\",\"MK\",\"MT\",\"MX\",\"MY\",\"NG\",\"NI\",\"NL\",\"NO\",\"NZ\",\"OM\",\"PA\",\"PE\",\"PH\",\"PL\",\"PT\",\"PY\",\"QA\",\"RO\",\"RS\",\"SA\",\"SE\",\"SG\",\"SI\",\"SK\",\"SN\",\"SV\",\"TH\",\"TN\",\"TR\",\"TT\",\"TW\",\"UA\",\"US\",\"UY\",\"VE\",\"VN\",\"XK\",\"ZA\"],\"external_urls\":{\"spotify\":\"https://open.spotify.com/album/5nuW5lV74AyC92DXxKAGqG\"},\"href\":\"https://api.spotify.com/v1/albums/5nuW5lV74AyC92DXxKAGqG\",\"id\":\"5nuW5lV74AyC92DXxKAGqG\",\"images\":[{\"height\":640,\"url\":\"https://i.scdn.co/image/ab67616d0000b2736b55737cd9a2bba789b1d6ba\",\"width\":640},{\"height\":300,\"url\":\"https://i.scdn.co/image/ab67616d00001e026b55737cd9a2bba789b1d6ba\",\"width\":300},{\"height\":64,\"url\":\"https://i.scdn.co/image/ab67616d000048516b55737cd9a2bba789b1d6ba\",\"width\":64}],\"name\":\"Sing Along Bangers\",\"release_date\":\"2021-06-11\",\"release_date_precision\":\"day\",\"total_tracks\":30,\"type\":\"album\",\"uri\":\"spotify:album:5nuW5lV74AyC92DXxKAGqG\"},\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/04gDigrS5kc9YWfZHwBETP\"},\"href\":\"https://api.spotify.com/v1/artists/04gDigrS5kc9YWfZHwBETP\",\"id\":\"04gDigrS5kc9YWfZHwBETP\",\"name\":\"Maroon 5\",\"type\":\"artist\",\"uri\":\"spotify:artist:04gDigrS5kc9YWfZHwBETP\"}],\"available_markets\":[\"AE\",\"AL\",\"AR\",\"AT\",\"AU\",\"BA\",\"BE\",\"BG\",\"BH\",\"BO\",\"BR\",\"CA\",\"CH\",\"CI\",\"CL\",\"CM\",\"CO\",\"CR\",\"CW\",\"CY\",\"CZ\",\"DE\",\"DK\",\"DO\",\"DZ\",\"EC\",\"EE\",\"EG\",\"ES\",\"FI\",\"FR\",\"GB\",\"GH\",\"GR\",\"GT\",\"HK\",\"HN\",\"HR\",\"HU\",\"ID\",\"IE\",\"IL\",\"IN\",\"IS\",\"IT\",\"JP\",\"KE\",\"KH\",\"KR\",\"KW\",\"LB\",\"LK\",\"LT\",\"LU\",\"LV\",\"MA\",\"ME\",\"MK\",\"MT\",\"MX\",\"MY\",\"NG\",\"NI\",\"NL\",\"NO\",\"NZ\",\"OM\",\"PA\",\"PE\",\"PH\",\"PL\",\"PT\",\"PY\",\"QA\",\"RO\",\"RS\",\"SA\",\"SE\",\"SG\",\"SI\",\"SK\",\"SN\",\"SV\",\"TH\",\"TN\",\"TR\",\"TT\",\"TW\",\"UA\",\"US\",\"UY\",\"VE\",\"VN\",\"XK\",\"ZA\"],\"disc_number\":1,\"duration_ms\":222706,\"episode\":false,\"explicit\":false,\"external_ids\":{\"isrc\":\"USUM71203844\"},\"external_urls\":{\"spotify\":\"https://open.spotify.com/track/1Vixb2G70s0J2Irf6hi8VE\"},\"href\":\"https://api.spotify.com/v1/tracks/1Vixb2G70s0J2Irf6hi8VE\",\"id\":\"1Vixb2G70s0J2Irf6hi8VE\",\"is_local\":false,\"name\":\"Payphone\",\"popularity\":61,\"preview_url\":null,\"track\":true,\"track_number\":10,\"type\":\"track\",\"uri\":\"spotify:track:1Vixb2G70s0J2Irf6hi8VE\"},\"video_thumbnail\":{\"url\":null}},{\"added_at\":\"2023-11-19T19:37:38Z\",\"added_by\":{\"external_urls\":{\"spotify\":\"https://open.spotify.com/user/31j46t4742w2idmgceppiyrffhuy\"},\"href\":\"https://api.spotify.com/v1/users/31j46t4742w2idmgceppiyrffhuy\",\"id\":\"31j46t4742w2idmgceppiyrffhuy\",\"type\":\"user\",\"uri\":\"spotify:user:31j46t4742w2idmgceppiyrffhuy\"},\"is_local\":false,\"primary_color\":null,\"track\":{\"album\":{\"album_type\":\"album\",\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/04gDigrS5kc9YWfZHwBETP\"},\"href\":\"https://api.spotify.com/v1/artists/04gDigrS5kc9YWfZHwBETP\",\"id\":\"04gDigrS5kc9YWfZHwBETP\",\"name\":\"Maroon 5\",\"type\":\"artist\",\"uri\":\"spotify:artist:04gDigrS5kc9YWfZHwBETP\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PL\",\"PT\",\"SK\",\"ES\",\"CH\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"BD\",\"PK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BI\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"external_urls\":{\"spotify\":\"https://open.spotify.com/album/2Auw0pTT6EcQdvHNimhLQI\"},\"href\":\"https://api.spotify.com/v1/albums/2Auw0pTT6EcQdvHNimhLQI\",\"id\":\"2Auw0pTT6EcQdvHNimhLQI\",\"images\":[{\"height\":640,\"url\":\"https://i.scdn.co/image/ab67616d0000b273442b53773d50e1b5369bb16c\",\"width\":640},{\"height\":300,\"url\":\"https://i.scdn.co/image/ab67616d00001e02442b53773d50e1b5369bb16c\",\"width\":300},{\"height\":64,\"url\":\"https://i.scdn.co/image/ab67616d00004851442b53773d50e1b5369bb16c\",\"width\":64}],\"name\":\"V\",\"release_date\":\"2014-09-02\",\"release_date_precision\":\"day\",\"total_tracks\":12,\"type\":\"album\",\"uri\":\"spotify:album:2Auw0pTT6EcQdvHNimhLQI\"},\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/04gDigrS5kc9YWfZHwBETP\"},\"href\":\"https://api.spotify.com/v1/artists/04gDigrS5kc9YWfZHwBETP\",\"id\":\"04gDigrS5kc9YWfZHwBETP\",\"name\":\"Maroon 5\",\"type\":\"artist\",\"uri\":\"spotify:artist:04gDigrS5kc9YWfZHwBETP\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PL\",\"PT\",\"SK\",\"ES\",\"CH\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"BD\",\"PK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BI\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"disc_number\":1,\"duration_ms\":189960,\"episode\":false,\"explicit\":false,\"external_ids\":{\"isrc\":\"USUM71407116\"},\"external_urls\":{\"spotify\":\"https://open.spotify.com/track/4gbVRS8gloEluzf0GzDOFc\"},\"href\":\"https://api.spotify.com/v1/tracks/4gbVRS8gloEluzf0GzDOFc\",\"id\":\"4gbVRS8gloEluzf0GzDOFc\",\"is_local\":false,\"name\":\"Maps\",\"popularity\":87,\"preview_url\":null,\"track\":true,\"track_number\":1,\"type\":\"track\",\"uri\":\"spotify:track:4gbVRS8gloEluzf0GzDOFc\"},\"video_thumbnail\":{\"url\":null}},{\"added_at\":\"2023-11-19T19:38:07Z\",\"added_by\":{\"external_urls\":{\"spotify\":\"https://open.spotify.com/user/31j46t4742w2idmgceppiyrffhuy\"},\"href\":\"https://api.spotify.com/v1/users/31j46t4742w2idmgceppiyrffhuy\",\"id\":\"31j46t4742w2idmgceppiyrffhuy\",\"type\":\"user\",\"uri\":\"spotify:user:31j46t4742w2idmgceppiyrffhuy\"},\"is_local\":false,\"primary_color\":null,\"track\":{\"album\":{\"album_type\":\"album\",\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/0kkxsdcaWmWU2yWAqclDh4\"},\"href\":\"https://api.spotify.com/v1/artists/0kkxsdcaWmWU2yWAqclDh4\",\"id\":\"0kkxsdcaWmWU2yWAqclDh4\",\"name\":\"Rixton\",\"type\":\"artist\",\"uri\":\"spotify:artist:0kkxsdcaWmWU2yWAqclDh4\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"XK\"],\"external_urls\":{\"spotify\":\"https://open.spotify.com/album/02ae5i5UAoFrt2peVox9Xd\"},\"href\":\"https://api.spotify.com/v1/albums/02ae5i5UAoFrt2peVox9Xd\",\"id\":\"02ae5i5UAoFrt2peVox9Xd\",\"images\":[{\"height\":640,\"url\":\"https://i.scdn.co/image/ab67616d0000b273647377a36072bd08e44dd32b\",\"width\":640},{\"height\":300,\"url\":\"https://i.scdn.co/image/ab67616d00001e02647377a36072bd08e44dd32b\",\"width\":300},{\"height\":64,\"url\":\"https://i.scdn.co/image/ab67616d00004851647377a36072bd08e44dd32b\",\"width\":64}],\"name\":\"Let The Road\",\"release_date\":\"2014-01-01\",\"release_date_precision\":\"day\",\"total_tracks\":10,\"type\":\"album\",\"uri\":\"spotify:album:02ae5i5UAoFrt2peVox9Xd\"},\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/0kkxsdcaWmWU2yWAqclDh4\"},\"href\":\"https://api.spotify.com/v1/artists/0kkxsdcaWmWU2yWAqclDh4\",\"id\":\"0kkxsdcaWmWU2yWAqclDh4\",\"name\":\"Rixton\",\"type\":\"artist\",\"uri\":\"spotify:artist:0kkxsdcaWmWU2yWAqclDh4\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"XK\"],\"disc_number\":1,\"duration_ms\":193733,\"episode\":false,\"explicit\":false,\"external_ids\":{\"isrc\":\"USUM71401800\"},\"external_urls\":{\"spotify\":\"https://open.spotify.com/track/1oew3nFNY3vMacJAsvry0S\"},\"href\":\"https://api.spotify.com/v1/tracks/1oew3nFNY3vMacJAsvry0S\",\"id\":\"1oew3nFNY3vMacJAsvry0S\",\"is_local\":false,\"name\":\"Me And My Broken Heart\",\"popularity\":80,\"preview_url\":null,\"track\":true,\"track_number\":5,\"type\":\"track\",\"uri\":\"spotify:track:1oew3nFNY3vMacJAsvry0S\"},\"video_thumbnail\":{\"url\":null}},{\"added_at\":\"2023-11-19T19:38:28Z\",\"added_by\":{\"external_urls\":{\"spotify\":\"https://open.spotify.com/user/31j46t4742w2idmgceppiyrffhuy\"},\"href\":\"https://api.spotify.com/v1/users/31j46t4742w2idmgceppiyrffhuy\",\"id\":\"31j46t4742w2idmgceppiyrffhuy\",\"type\":\"user\",\"uri\":\"spotify:user:31j46t4742w2idmgceppiyrffhuy\"},\"is_local\":false,\"primary_color\":null,\"track\":{\"album\":{\"album_type\":\"album\",\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/246dkjvS1zLTtiykXe5h60\"},\"href\":\"https://api.spotify.com/v1/artists/246dkjvS1zLTtiykXe5h60\",\"id\":\"246dkjvS1zLTtiykXe5h60\",\"name\":\"Post Malone\",\"type\":\"artist\",\"uri\":\"spotify:artist:246dkjvS1zLTtiykXe5h60\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"external_urls\":{\"spotify\":\"https://open.spotify.com/album/5s0rmjP8XOPhP6HhqOhuyC\"},\"href\":\"https://api.spotify.com/v1/albums/5s0rmjP8XOPhP6HhqOhuyC\",\"id\":\"5s0rmjP8XOPhP6HhqOhuyC\",\"images\":[{\"height\":640,\"url\":\"https://i.scdn.co/image/ab67616d0000b27355404f712deb84d0650a4b41\",\"width\":640},{\"height\":300,\"url\":\"https://i.scdn.co/image/ab67616d00001e0255404f712deb84d0650a4b41\",\"width\":300},{\"height\":64,\"url\":\"https://i.scdn.co/image/ab67616d0000485155404f712deb84d0650a4b41\",\"width\":64}],\"name\":\"Stoney (Deluxe)\",\"release_date\":\"2016-12-09\",\"release_date_precision\":\"day\",\"total_tracks\":18,\"type\":\"album\",\"uri\":\"spotify:album:5s0rmjP8XOPhP6HhqOhuyC\"},\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/246dkjvS1zLTtiykXe5h60\"},\"href\":\"https://api.spotify.com/v1/artists/246dkjvS1zLTtiykXe5h60\",\"id\":\"246dkjvS1zLTtiykXe5h60\",\"name\":\"Post Malone\",\"type\":\"artist\",\"uri\":\"spotify:artist:246dkjvS1zLTtiykXe5h60\"},{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/0VRj0yCOv2FXJNP47XQnx5\"},\"href\":\"https://api.spotify.com/v1/artists/0VRj0yCOv2FXJNP47XQnx5\",\"id\":\"0VRj0yCOv2FXJNP47XQnx5\",\"name\":\"Quavo\",\"type\":\"artist\",\"uri\":\"spotify:artist:0VRj0yCOv2FXJNP47XQnx5\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"disc_number\":1,\"duration_ms\":220293,\"episode\":false,\"explicit\":true,\"external_ids\":{\"isrc\":\"USUM71614484\"},\"external_urls\":{\"spotify\":\"https://open.spotify.com/track/3a1lNhkSLSkpJE4MSHpDu9\"},\"href\":\"https://api.spotify.com/v1/tracks/3a1lNhkSLSkpJE4MSHpDu9\",\"id\":\"3a1lNhkSLSkpJE4MSHpDu9\",\"is_local\":false,\"name\":\"Congratulations\",\"popularity\":84,\"preview_url\":null,\"track\":true,\"track_number\":12,\"type\":\"track\",\"uri\":\"spotify:track:3a1lNhkSLSkpJE4MSHpDu9\"},\"video_thumbnail\":{\"url\":null}},{\"added_at\":\"2023-11-19T19:38:58Z\",\"added_by\":{\"external_urls\":{\"spotify\":\"https://open.spotify.com/user/31j46t4742w2idmgceppiyrffhuy\"},\"href\":\"https://api.spotify.com/v1/users/31j46t4742w2idmgceppiyrffhuy\",\"id\":\"31j46t4742w2idmgceppiyrffhuy\",\"type\":\"user\",\"uri\":\"spotify:user:31j46t4742w2idmgceppiyrffhuy\"},\"is_local\":false,\"primary_color\":null,\"track\":{\"album\":{\"album_type\":\"album\",\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/4r63FhuTkUYltbVAg5TQnk\"},\"href\":\"https://api.spotify.com/v1/artists/4r63FhuTkUYltbVAg5TQnk\",\"id\":\"4r63FhuTkUYltbVAg5TQnk\",\"name\":\"DaBaby\",\"type\":\"artist\",\"uri\":\"spotify:artist:4r63FhuTkUYltbVAg5TQnk\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"external_urls\":{\"spotify\":\"https://open.spotify.com/album/623PL2MBg50Br5dLXC9E9e\"},\"href\":\"https://api.spotify.com/v1/albums/623PL2MBg50Br5dLXC9E9e\",\"id\":\"623PL2MBg50Br5dLXC9E9e\",\"images\":[{\"height\":640,\"url\":\"https://i.scdn.co/image/ab67616d0000b27320e08c8cc23f404d723b5647\",\"width\":640},{\"height\":300,\"url\":\"https://i.scdn.co/image/ab67616d00001e0220e08c8cc23f404d723b5647\",\"width\":300},{\"height\":64,\"url\":\"https://i.scdn.co/image/ab67616d0000485120e08c8cc23f404d723b5647\",\"width\":64}],\"name\":\"BLAME IT ON BABY\",\"release_date\":\"2020-04-17\",\"release_date_precision\":\"day\",\"total_tracks\":13,\"type\":\"album\",\"uri\":\"spotify:album:623PL2MBg50Br5dLXC9E9e\"},\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/4r63FhuTkUYltbVAg5TQnk\"},\"href\":\"https://api.spotify.com/v1/artists/4r63FhuTkUYltbVAg5TQnk\",\"id\":\"4r63FhuTkUYltbVAg5TQnk\",\"name\":\"DaBaby\",\"type\":\"artist\",\"uri\":\"spotify:artist:4r63FhuTkUYltbVAg5TQnk\"},{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/757aE44tKEUQEqRuT6GnEB\"},\"href\":\"https://api.spotify.com/v1/artists/757aE44tKEUQEqRuT6GnEB\",\"id\":\"757aE44tKEUQEqRuT6GnEB\",\"name\":\"Roddy Ricch\",\"type\":\"artist\",\"uri\":\"spotify:artist:757aE44tKEUQEqRuT6GnEB\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"disc_number\":1,\"duration_ms\":181733,\"episode\":false,\"explicit\":true,\"external_ids\":{\"isrc\":\"USUM72007941\"},\"external_urls\":{\"spotify\":\"https://open.spotify.com/track/7ytR5pFWmSjzHJIeQkgog4\"},\"href\":\"https://api.spotify.com/v1/tracks/7ytR5pFWmSjzHJIeQkgog4\",\"id\":\"7ytR5pFWmSjzHJIeQkgog4\",\"is_local\":false,\"name\":\"ROCKSTAR (feat. Roddy Ricch)\",\"popularity\":79,\"preview_url\":null,\"track\":true,\"track_number\":7,\"type\":\"track\",\"uri\":\"spotify:track:7ytR5pFWmSjzHJIeQkgog4\"},\"video_thumbnail\":{\"url\":null}},{\"added_at\":\"2023-11-19T19:39:21Z\",\"added_by\":{\"external_urls\":{\"spotify\":\"https://open.spotify.com/user/31j46t4742w2idmgceppiyrffhuy\"},\"href\":\"https://api.spotify.com/v1/users/31j46t4742w2idmgceppiyrffhuy\",\"id\":\"31j46t4742w2idmgceppiyrffhuy\",\"type\":\"user\",\"uri\":\"spotify:user:31j46t4742w2idmgceppiyrffhuy\"},\"is_local\":false,\"primary_color\":null,\"track\":{\"album\":{\"album_type\":\"single\",\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/1uU7g3DNSbsu0QjSEqZtEd\"},\"href\":\"https://api.spotify.com/v1/artists/1uU7g3DNSbsu0QjSEqZtEd\",\"id\":\"1uU7g3DNSbsu0QjSEqZtEd\",\"name\":\"Masked Wolf\",\"type\":\"artist\",\"uri\":\"spotify:artist:1uU7g3DNSbsu0QjSEqZtEd\"}],\"available_markets\":[\"AR\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"external_urls\":{\"spotify\":\"https://open.spotify.com/album/7vus4Q8r5DS2Dl1JClxEsA\"},\"href\":\"https://api.spotify.com/v1/albums/7vus4Q8r5DS2Dl1JClxEsA\",\"id\":\"7vus4Q8r5DS2Dl1JClxEsA\",\"images\":[{\"height\":640,\"url\":\"https://i.scdn.co/image/ab67616d0000b27397fdd7cf1b14d78c6a7fb17f\",\"width\":640},{\"height\":300,\"url\":\"https://i.scdn.co/image/ab67616d00001e0297fdd7cf1b14d78c6a7fb17f\",\"width\":300},{\"height\":64,\"url\":\"https://i.scdn.co/image/ab67616d0000485197fdd7cf1b14d78c6a7fb17f\",\"width\":64}],\"name\":\"Astronaut In The Ocean\",\"release_date\":\"2021-01-06\",\"release_date_precision\":\"day\",\"total_tracks\":1,\"type\":\"album\",\"uri\":\"spotify:album:7vus4Q8r5DS2Dl1JClxEsA\"},\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/1uU7g3DNSbsu0QjSEqZtEd\"},\"href\":\"https://api.spotify.com/v1/artists/1uU7g3DNSbsu0QjSEqZtEd\",\"id\":\"1uU7g3DNSbsu0QjSEqZtEd\",\"name\":\"Masked Wolf\",\"type\":\"artist\",\"uri\":\"spotify:artist:1uU7g3DNSbsu0QjSEqZtEd\"}],\"available_markets\":[\"AR\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"disc_number\":1,\"duration_ms\":132780,\"episode\":false,\"explicit\":true,\"external_ids\":{\"isrc\":\"USAT22100017\"},\"external_urls\":{\"spotify\":\"https://open.spotify.com/track/3Ofmpyhv5UAQ70mENzB277\"},\"href\":\"https://api.spotify.com/v1/tracks/3Ofmpyhv5UAQ70mENzB277\",\"id\":\"3Ofmpyhv5UAQ70mENzB277\",\"is_local\":false,\"name\":\"Astronaut In The Ocean\",\"popularity\":77,\"preview_url\":\"https://p.scdn.co/mp3-preview/e89e477c2467c477031561ff801c055c5777de4f?cid=431bb817cb2a4ff59be3d654da8d25dc\",\"track\":true,\"track_number\":1,\"type\":\"track\",\"uri\":\"spotify:track:3Ofmpyhv5UAQ70mENzB277\"},\"video_thumbnail\":{\"url\":null}},{\"added_at\":\"2023-11-19T19:39:52Z\",\"added_by\":{\"external_urls\":{\"spotify\":\"https://open.spotify.com/user/31j46t4742w2idmgceppiyrffhuy\"},\"href\":\"https://api.spotify.com/v1/users/31j46t4742w2idmgceppiyrffhuy\",\"id\":\"31j46t4742w2idmgceppiyrffhuy\",\"type\":\"user\",\"uri\":\"spotify:user:31j46t4742w2idmgceppiyrffhuy\"},\"is_local\":false,\"primary_color\":null,\"track\":{\"album\":{\"album_type\":\"album\",\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/757aE44tKEUQEqRuT6GnEB\"},\"href\":\"https://api.spotify.com/v1/artists/757aE44tKEUQEqRuT6GnEB\",\"id\":\"757aE44tKEUQEqRuT6GnEB\",\"name\":\"Roddy Ricch\",\"type\":\"artist\",\"uri\":\"spotify:artist:757aE44tKEUQEqRuT6GnEB\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"external_urls\":{\"spotify\":\"https://open.spotify.com/album/52u4anZbHd6UInnmHRFzba\"},\"href\":\"https://api.spotify.com/v1/albums/52u4anZbHd6UInnmHRFzba\",\"id\":\"52u4anZbHd6UInnmHRFzba\",\"images\":[{\"height\":640,\"url\":\"https://i.scdn.co/image/ab67616d0000b273600adbc750285ea1a8da249f\",\"width\":640},{\"height\":300,\"url\":\"https://i.scdn.co/image/ab67616d00001e02600adbc750285ea1a8da249f\",\"width\":300},{\"height\":64,\"url\":\"https://i.scdn.co/image/ab67616d00004851600adbc750285ea1a8da249f\",\"width\":64}],\"name\":\"Please Excuse Me for Being Antisocial\",\"release_date\":\"2019-12-06\",\"release_date_precision\":\"day\",\"total_tracks\":16,\"type\":\"album\",\"uri\":\"spotify:album:52u4anZbHd6UInnmHRFzba\"},\"artists\":[{\"external_urls\":{\"spotify\":\"https://open.spotify.com/artist/757aE44tKEUQEqRuT6GnEB\"},\"href\":\"https://api.spotify.com/v1/artists/757aE44tKEUQEqRuT6GnEB\",\"id\":\"757aE44tKEUQEqRuT6GnEB\",\"name\":\"Roddy Ricch\",\"type\":\"artist\",\"uri\":\"spotify:artist:757aE44tKEUQEqRuT6GnEB\"}],\"available_markets\":[\"AR\",\"AU\",\"AT\",\"BE\",\"BO\",\"BR\",\"BG\",\"CA\",\"CL\",\"CO\",\"CR\",\"CY\",\"CZ\",\"DK\",\"DO\",\"DE\",\"EC\",\"EE\",\"SV\",\"FI\",\"FR\",\"GR\",\"GT\",\"HN\",\"HK\",\"HU\",\"IS\",\"IE\",\"IT\",\"LV\",\"LT\",\"LU\",\"MY\",\"MT\",\"MX\",\"NL\",\"NZ\",\"NI\",\"NO\",\"PA\",\"PY\",\"PE\",\"PH\",\"PL\",\"PT\",\"SG\",\"SK\",\"ES\",\"SE\",\"CH\",\"TW\",\"TR\",\"UY\",\"US\",\"GB\",\"AD\",\"LI\",\"MC\",\"ID\",\"JP\",\"TH\",\"VN\",\"RO\",\"IL\",\"ZA\",\"SA\",\"AE\",\"BH\",\"QA\",\"OM\",\"KW\",\"EG\",\"MA\",\"DZ\",\"TN\",\"LB\",\"JO\",\"PS\",\"IN\",\"BY\",\"KZ\",\"MD\",\"UA\",\"AL\",\"BA\",\"HR\",\"ME\",\"MK\",\"RS\",\"SI\",\"KR\",\"BD\",\"PK\",\"LK\",\"GH\",\"KE\",\"NG\",\"TZ\",\"UG\",\"AG\",\"AM\",\"BS\",\"BB\",\"BZ\",\"BT\",\"BW\",\"BF\",\"CV\",\"CW\",\"DM\",\"FJ\",\"GM\",\"GE\",\"GD\",\"GW\",\"GY\",\"HT\",\"JM\",\"KI\",\"LS\",\"LR\",\"MW\",\"MV\",\"ML\",\"MH\",\"FM\",\"NA\",\"NR\",\"NE\",\"PW\",\"PG\",\"WS\",\"SM\",\"ST\",\"SN\",\"SC\",\"SL\",\"SB\",\"KN\",\"LC\",\"VC\",\"SR\",\"TL\",\"TO\",\"TT\",\"TV\",\"VU\",\"AZ\",\"BN\",\"BI\",\"KH\",\"CM\",\"TD\",\"KM\",\"GQ\",\"SZ\",\"GA\",\"GN\",\"KG\",\"LA\",\"MO\",\"MR\",\"MN\",\"NP\",\"RW\",\"TG\",\"UZ\",\"ZW\",\"BJ\",\"MG\",\"MU\",\"MZ\",\"AO\",\"CI\",\"DJ\",\"ZM\",\"CD\",\"CG\",\"IQ\",\"LY\",\"TJ\",\"VE\",\"ET\",\"XK\"],\"disc_number\":1,\"duration_ms\":196652,\"episode\":false,\"explicit\":true,\"external_ids\":{\"isrc\":\"USAT21906978\"},\"external_urls\":{\"spotify\":\"https://open.spotify.com/track/0nbXyq5TXYPCO7pr3N8S4I\"},\"href\":\"https://api.spotify.com/v1/tracks/0nbXyq5TXYPCO7pr3N8S4I\",\"id\":\"0nbXyq5TXYPCO7pr3N8S4I\",\"is_local\":false,\"name\":\"The Box\",\"popularity\":86,\"preview_url\":\"https://p.scdn.co/mp3-preview/6306fda4df77cbcaf47c8b9fa3575ce457504c9c?cid=431bb817cb2a4ff59be3d654da8d25dc\",\"track\":true,\"track_number\":2,\"type\":\"track\",\"uri\":\"spotify:track:0nbXyq5TXYPCO7pr3N8S4I\"},\"video_thumbnail\":{\"url\":null}}],\"limit\":100,\"next\":null,\"offset\":0,\"previous\":null,\"total\":7}";
                        TracksResponse tracks = objectMapper.readValue(playListResponse, TracksResponse.class);

                        List<SongItem> songs = tracks.getItems();
                        if (!songs.isEmpty()) {
                            for (SongItem song: songs) {
                                String songArtist = "";
                                String songName = "";

                                Track track = song.getTrack();
                                List<Artist> songArtists = track.getArtists();
                                songName = track.getName();
                                if (!songArtists.isEmpty()) {
                                    songArtist = songArtists.get(0).getName();
                                }
                                final String createSongURL = "http://localhost:8080/api/v1/songs";

                                RestTemplate restTemplate = new RestTemplate();

                                HttpHeaders headers = new HttpHeaders();
                                headers.setContentType(MediaType.APPLICATION_JSON);

                                Map<String, String> params = new HashMap<>();
                                params.put("name", songName);
                                params.put("artist", songArtist);

                                ObjectMapper bodyObjectMapper = new ObjectMapper();
                                String requestBody = null;
                                try {
                                    requestBody = bodyObjectMapper.writeValueAsString(params);
                                    System.out.println(requestBody);
                                } catch (JsonProcessingException e) {
                                    System.out.println("Could not parse song name and artist: " + e);
                                }

                                HttpEntity<String> requestEntity = new HttpEntity<>(requestBody.toString(), headers);

                                ResponseEntity<String> response = restTemplate.exchange(createSongURL, HttpMethod.POST, requestEntity, String.class);

                                HttpStatusCode statusCode = response.getStatusCode();
                                if (statusCode == HttpStatus.OK) {
                                    String responseSongId = response.getBody();
                                    responseSongId = responseSongId.substring(1, responseSongId.length() - 1);

                                    String addSongToUserURL = "http://localhost:8080/api/v1/users/" + String.valueOf(userId) + "/songs/" + responseSongId;

                                    restTemplate = new RestTemplate();

                                    headers = new HttpHeaders();

                                    response = restTemplate.exchange(
                                            addSongToUserURL,
                                            HttpMethod.PUT,
                                            new HttpEntity<>(headers),
                                            String.class);
                                    statusCode = response.getStatusCode();
                                    if (statusCode == HttpStatus.OK) {
                                        System.out.println("Added song " + responseSongId + " to user " + userId);
                                    } else {
                                        System.out.println("Request failed with status code: " + statusCode);
                                    }
                                } else {
                                    System.out.println("Request failed with status code: " + statusCode);
                                }
                            }
                        }
                    }
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
